!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.blip=t()}(this,function(){"use strict";function n(){function n(n){var t=(Math.random().toString(16)+"000000000").substr(2,8);return n?"-"+t.substr(0,4)+"-"+t.substr(4,4):t}return n()+n(!0)+n(!0)+n()}function t(n){this.nodes=n||[]}function e(){return this.inputs=new t,this.outputs=new t,this}function r(){return o.currentTime}var o=new AudioContext;t.prototype={count:function(){return this.nodes.length},each:function(n){for(var t=0;t<this.nodes.length;t++)n.call(this,this.nodes[t],t,this.nodes)},contains:function(n){for(var t=0;t<this.nodes.length;t++)if(this.nodes[t]===n)return!0;return!1},add:function(n){-1===this.nodes.indexOf(n)&&this.nodes.push(n)},remove:function(n){var t=this.nodes.indexOf(n);-1!==t&&this.nodes.splice(t,1)},removeAll:function(){this.nodes=[]}};var u={gain:o.createGain,delay:o.createDelay,panner:o.createPanner,convolver:o.createConvolver,analyser:o.createAnalyser,channelSplitter:o.createChannelSplitter,channelMerger:o.createChannelMerger,dynamicsCompressor:o.createDynamicsCompressor,biquadFilter:o.createBiquadFilter,waveShaper:o.createWaveShaper,oscillator:o.createOscillator,periodicWave:o.createPeriodicWave,bufferSource:o.createBufferSource,audioBufferSource:o.createBufferSource};e.prototype.connect=function(n){return this.node().numberOfOutputs>0&&n.node().numberOfInputs>0&&(this.node().connect(n.node()),this.outputs.add(n),n.inputs.add(this)),this},e.prototype.disconnect=function(n){this.node().disconnect();var t=this;return n?(this.outputs.remove(n),n.inputs.remove(this),this.outputs.each(function(n){this.connect(n)})):(this.outputs.each(function(n){n.inputs.remove(t)}),this.outputs.removeAll()),this},e.prototype.prop=function(n,t){if(arguments.length<2){if("object"==typeof n){for(var e in n)this.node()[e]=n[e];return this}return this.node()[n]}return this.node()[n]=t,this},e.prototype.param=function(n,t){return arguments.length<2?this.node()[n]:("function"!=typeof t?this.node()[n].value=t:t.call(this.node()[n]),this)},e.prototype.start=function(n){this.node().start.call(this.node(),n)},e.prototype.stop=function(n){this.node().stop.call(this.node(),n)},e.prototype.node=function(){return this.node()},e.prototype.toString=function(){return"[object BlipNode]"},e.prototype.valueOf=function(){return this.id()},e.prototype.call=function(n){var t=Array.prototype.slice.call(arguments,1),e=this.node();"function"==typeof e[n]&&e[n].apply(e,t)},e.fromAudioNode=function(t){var r=new e,o=n();return r.node=function(){return t},r.id=function(){return o},r},e.create=function(t){function r(n){return u[n].apply(o,i)}var i=Array.prototype.slice.call(arguments,1),c=r(t),a=n(),s=new e;return s.node=function(){return c},s.id=function(){return a},s};var i=e.fromAudioNode(o.destination),c={},a={};a.get=function(n){return c[n]},a.set=function(n,t){c[n]=t},a.list=function(){return Object.keys(c)};var s=function(){var n=void 0,t=1,r=1,u=null,c=e.create("gain").connect(i),s={};return s.sample=function(t){return arguments.length?(n=a.get(t),s):n},s.rate=function(n){return arguments.length?(t=n,s):t},s.gain=function(n){return arguments.length?(r=n,c.param("gain",r),s):r},s.chain=function(n){return arguments.length?(u=n,c.disconnect(i),u.from(c).to(i),s):u},s.play=function(t,e){t=t||0;var r=o.createBufferSource();r.buffer=n,r.playbackRate.value=s.rate(),"function"==typeof e&&e.call(s,r),r.connect(c.node()),r.start(t)},s},f=function(n){function t(){for(var t=0;t<n.length-1;t++)n[t].connect(n[t+1])}n=n||[],t();var e={};return e.node=function(r){return n.push(r),t(),e},e.start=function(){var t=n.slice(0,1);return t.length?t[0]:null},e.end=function(){var t=n.slice(-1);return t.length?t[0]:null},e.from=function(n){return n.connect(e.start()),e},e.to=function(n){return e.end().connect(n),e},e.wire=function(){return t(),e},e},l=function(){function n(){l+=a,++f>=s.length&&(f=0,p+=1)}function t(n,t){d.call(v,t,s[n],n)}function e(n,t){h.call(v,t,n)}function r(){for(;l<o.currentTime+i;)if(t(f,l),0===f&&e(p,l),n(),m&&p>=m)return void v.reset();g=window.setTimeout(r,u)}var u=25,i=.1,c=void 0,a=void 0,s=[],f=0,l=0,d=function(n,t,e){},h=function(n,t){},p=0,m=0,g=void 0,v={};return v.tempo=function(n){return arguments.length?(c=n,a=60/c,v):c},v.tickInterval=function(n){return arguments.length?(a=n,c=60/a,v):a},v.data=function(n){return arguments.length?(s=n,v):s},v.lookahead=function(n){return arguments.length?(u=n,v):u},v.scheduleAheadTime=function(n){return arguments.length?(i=n,v):i},v.limit=function(n){return arguments.length?(m=n,v):m},v.tick=function(n){return arguments.length?(d=n,v):d},v.each=function(n){return arguments.length?(h=n,v):h},v.start=function(n){return l=n||o.currentTime,r(),v},v.stop=function(){return window.clearTimeout(g),v},v.reset=function(){return f=0,p=0,v},v},d=function(n){var t=Object.keys(n),e=t.map(function(t){var e=n[t];return new Promise(function(n,t){fetch(e,{method:"GET"}).then(function(n){return n.arrayBuffer()},t).then(function(e){o.decodeAudioData(e,function(t){n(t)},t)},t)})});return Promise.all(e).then(function(n){t.map(function(t,e){a.set(t,n[e])})})},h={};h.now=r,h["in"]=function(n){return r()+n},h.seconds=function(n){return n},h.ms=function(n){return n/1e3},h.samp=function(n){return n/o.sampleRate};var p=function(n,t){switch(arguments.length){case 0:return Math.random();case 1:return Math.random()*n;case 2:return Math.random()*(t-n)+n}},m=function(n){var t=Math.random();return n>t},g={};return g.version="0.4.0",g.time=h,g.random=p,g.chance=m,g.node=e.create,g.clip=s,g.chain=f,g.loop=l,g.destination=i,g.listener=e.fromAudioNode(o.listener),g.getContext=function(){return o},g.loadSamples=d,g.sampleLibrary=a,g});